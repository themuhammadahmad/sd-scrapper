<!DOCTYPE html>
<html>

<head>
  <title>Scraper Control</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/navbar.css">
  <style>
    /* Scrap button styles */
.btn-scrap-site {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
}

.btn-scrap-site:hover:not(:disabled) {
    background: linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.btn-scrap-site:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.btn-scrap-site.loading {
    background: linear-gradient(135deg, #a0aec0 0%, #718096 100%);
}

.btn-small {
    padding: 4px 10px !important;
    font-size: 11px !important;
}

/* Prevent site item click when clicking scrap button */
.site-item > div > button {
    pointer-events: auto;
}

.site-item > div > button:hover {
    z-index: 10;
}
/* Add to your existing CSS */
.failed-item .btn-scrap-site {
    background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
    color: white;
    border: none;
    padding: 4px 8px;
    border-radius: 3px;
    font-size: 11px;
    cursor: pointer;
}

.failed-item .btn-scrap-site:hover:not(:disabled) {
    background: linear-gradient(135deg, #43A047 0%, #1B5E20 100%);
}

.failed-item .btn-scrap-site:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.failed-item .btn {
    padding: 4px 8px;
    font-size: 11px;
}
  </style>
  <style>

  </style>

</head>

<body>
    <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-container">
      <a href="/" class="navbar-brand">
        <i>ğŸ”</i> StaffScraper Pro
      </a>
      
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
      
      <ul class="navbar-menu" id="navbarMenu">
        <li class="navbar-item">
          <a href="/" class="navbar-link active">
            <i>ğŸ </i> Home
          </a>
        </li>
        <li class="navbar-item">
    <a href="changes" class="navbar-link">
        <i class="fas fa-history"></i> Changes Dashboard
    </a>
</li>
        <!-- <li class="navbar-item">
          <a href="search" class="navbar-link">
            <i>ğŸ”</i> Staff Search
          </a>
        </li> -->
        <li class="navbar-item">
          <a href="download" class="navbar-link">
            <i>ğŸ”</i> Download
          </a>
        </li>
        
          
    <button id="loginBtn" class="btn btn-primary" style="display: none;">Login</button>
    <button id="logoutBtn" class="btn btn-secondary" style="display: none;">Logout</button>
      
      </ul>
    </div>
  </nav>




<div class="header-container">
    <!-- <a href="snapshots" class="nav-link">ğŸ“¸ View Snapshots</a> -->
       <span id="userInfo"></span>
    <h1 class="main-title">Staff Directory Scraper</h1>
    
<div class="button-group">
  <button class="btn btn-primary" onclick="triggerScraping()" id="startBtn">ğŸš€ Start Scraping Now</button>
  <button class="btn btn-danger" onclick="stopScraping()" id="stopBtn" disabled>â¹ï¸ Stop Scraping</button>
  <button class="btn btn-secondary" onclick="fetchSites(1)">ğŸ“‹ Fetch Available Sites</button>
  <button class="btn btn-warning" onclick="fetchFailedDirectories()">âš ï¸ View Failed Directories</button>
  <!-- <button class="btn btn-danger" onclick="clearFailedDirectories()">ğŸ—‘ï¸ Clear Failed List</button> -->
</div>
    
<!-- Update the search container in your header -->
<div class="search-container">
    <div class="search-box">
        <input type="text" id="siteSearch" placeholder="ğŸ” Search sites by domain or directory..." 
               onkeypress="handleSearchKeypress(event)">
        <button class="btn btn-primary" onclick="performSearch(event)">Search</button>
        <button class="btn btn-secondary" onclick="clearSearch(event)">Clear</button>
    </div>
</div>
    
    <div id="status" class="status-container"></div>
</div>

  <div id="sitesList" style="margin: 20px 0;"></div>
  <div id="failedList" style="margin: 20px 0;"></div>
  <div id="snapshotData" style="margin: 20px 0;"></div>
  <div id="changeHistory" style="margin: 20px 0;"></div>



  <script src="js/auth.js"></script>

  <script src="js/index.js"></script>
  <script>
    // Function to check monthly scheduling status
async function checkMonthlyScheduling() {
  try {
    // console.log('ğŸ” Checking monthly scheduling status...');
    
    const response = await fetch('/api/monthly-scheduling-status', {
      headers: {
        'Content-Type': 'application/json'
      },
      credentials: 'same-origin' // Include cookies for authentication
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    const data = await response.json();
    
    // console.log('ğŸ“… Monthly Scheduling Status:', data);
    // console.log('ğŸ“Š Details:', {
    //   isActive: data.isMonthlyJobActive,
    //   nextRun: data.nextRunHuman,
    //   description: data.description
    // });
    
    return data;
  } catch (error) {
    console.error('âŒ Error checking monthly scheduling:', error);
    return null;
  }
}

// Function to check scraping status
async function checkScrapingStatus() {
  try {
    // console.log('ğŸ” Checking scraping status...');
    
    const response = await fetch('/api/scrape-status', {
      headers: {
        'Content-Type': 'application/json'
      },
      credentials: 'same-origin'
    });
    
    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }
    
    const data = await response.json();
    
    // console.log('ğŸ”„ Scraping Status:', data);
    // console.log('ğŸ“Š Details:', {
    //   isRunning: data.isRunning,
    //   currentlyProcessing: data.progress?.currentlyProcessingUrl || 'None',
    //   successCount: data.progress?.successCount || 0,
    //   errorCount: data.progress?.errorCount || 0
    // });
    
    return data;
  } catch (error) {
    console.error('âŒ Error checking scraping status:', error);
    return null;
  }
}

// Function to check both statuses
async function checkAllStatus() {
  // console.log('ğŸš€ Checking all system statuses...');
  
  const monthlyStatus = await checkMonthlyScheduling();
  const scrapingStatus = await checkScrapingStatus();
  
  // console.log('âœ… Status check complete');
  return { monthlyStatus, scrapingStatus };
}
checkAllStatus()
  </script>
</body>

</html>